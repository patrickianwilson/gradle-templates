/*
This plugin expects the following project extensions to be defined BEFORE the plugin is applied.

project.ext {
    dockerTag = "welcome:latest"
    dockerFile = "$projectDir/deploy/Dockerfile"
    dockerWorkingDir = "$projectDir/deploy"
}
*/



task assembleDockerImage(type: Exec, dependsOn: ["copyGoSrc","copyGoDeps"]) {
    workingDir "$project.buildDir/gopath"
    commandLine 'docker', 'build', '-f', project.dockerFile, '-t', project.dockerTag, "$project.buildDir/gopath"

    ext.output = {
        return standardOutput.toString()
    }

    inputs.file project.dockerFile
    inputs.dir "$project.buildDir/gopath"

}


