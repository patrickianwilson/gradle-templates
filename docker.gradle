/*
This plugin expects the following project extensions to be defined BEFORE the plugin is applied.

project.ext {
    dockerTag = "welcome:latest"
    dockerFile = "$projectDir/deploy/Dockerfile"
    dockerWorkingDir = "$projectDir/deploy"
}
*/

task assembleDockerImage(type: Exec, dependsOn: "assembleJs") {
    workingDir "$projectDir"
    commandLine 'docker', 'build', '-f', project.dockerFile, '-t', project.dockerImagePath, project.dockerWorkingDir

    standardOutput = new ByteArrayOutputStream()

    ext.output = {
        return standardOutput.toString()
    }


    inputs.file project.dockerFile
    inputs.dir project.dockerWorkingDir

}

assembleDockerImage << {
    String dockerOut = ext.output()
    logger.info "Docker output: " + dockerOut

}
